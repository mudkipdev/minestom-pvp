# Fix: Totem to Check Bypasses Invulnerability Instead of Just Out of World

**Commit Hash:** 7af925f
**File Modified:** `src/main/java/io/github/togar2/pvp/feature/totem/VanillaTotemFeature.java` (Line 31)
**Severity:** MEDIUM

## Issue

Totem of Undying protection was only blocked for `OUT_OF_WORLD` damage, but vanilla blocks it for all damage types that bypass invulnerability (including `GENERIC_KILL`).

### Before
```java
if (DamageTypeInfo.of(MinecraftServer.getDamageTypeRegistry().getKey(type)).outOfWorld()) return false;
```

### After
```java
if (DamageTypeInfo.of(MinecraftServer.getDamageTypeRegistry().getKey(type)).bypassesInvulnerability()) return false;
```

## Vanilla Reference

**Reference File:** `/reference/minecraft/net/minecraft/world/entity/LivingEntity.java` (Line 1372)

Vanilla checks if damage is tagged with `BYPASSES_INVULNERABILITY`:
```java
if (killingDamage.is(DamageTypeTags.BYPASSES_INVULNERABILITY)) {
    return false;  // Totem cannot protect
}
```

Damage types that bypass invulnerability:
- `OUT_OF_WORLD` - Falling into void
- `GENERIC_KILL` - Admin kill commands
- Any custom damage type tagged with BYPASSES_INVULNERABILITY

## Impact

**Before Fix:**
- `GENERIC_KILL` damage would still trigger totem protection
- Custom bypasses_invulnerability damages would incorrectly allow totem protection

**After Fix:**
- Totem correctly cannot protect against any damage that bypasses invulnerability frames
- Prevents exploitation of totem mechanic through alternate damage types

## Testing

Test totem protection:
1. Use kill command (@kill) - totem should NOT protect
2. Fall into void - totem should NOT protect
3. Take normal damage - totem SHOULD protect
4. Take fall damage - totem SHOULD protect
